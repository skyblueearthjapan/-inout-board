# 外出記入板 Webアプリ

Google Apps Script + HTML で構築された外出記録管理システムです。

## 📁 ファイル構成

```
├── Code.gs           # メインエントリポイント（doGet, API）
├── SheetService.gs   # スプレッドシート読み書き
├── Validation.gs     # 入力検証・正規化
├── Setup.gs          # 初期設定ヘルパー
├── index.html        # メインHTML
├── style.html        # CSS
└── ui.js.html        # フロントエンドJS
```

## 🚀 セットアップ手順

### 1. GASプロジェクト作成

1. [Google Apps Script](https://script.google.com/) で新規プロジェクトを作成
2. 各ファイルを作成し、コードをコピー
   - `.gs` ファイル → 「ファイル」→「新規作成」→「スクリプト」
   - `.html` ファイル → 「ファイル」→「新規作成」→「HTML」

### 2. スクリプトプロパティの設定

1. `Setup.gs` の `initializeProperties()` 関数を開く
2. `SPREADSHEET_ID` に対象スプレッドシートのIDを設定
   - URLの `/d/` と `/edit` の間の部分
   - 例: `https://docs.google.com/spreadsheets/d/【ここがID】/edit`
3. 必要に応じて他の設定値も変更
4. `initializeProperties()` を実行

### 3. 接続テスト

1. `Setup.gs` の `testConnection()` を実行
2. 「接続テスト成功」と表示されればOK

### 4. デプロイ

1. 「デプロイ」→「新しいデプロイ」
2. 種類：「ウェブアプリ」を選択
3. 設定：
   - 説明：任意（例：v1.0）
   - 次のユーザーとして実行：**自分**
   - アクセスできるユーザー：**組織内の全員**（または適切な範囲）
4. 「デプロイ」をクリック
5. 表示されたURLにアクセス

## 📋 シート構造（前提）

```
A列    B列      C列        D列        E列
─────────────────────────────────────────
       外出記入板          12/21/2025  日付  ← 2行目（D2が日付セル）
人員   行先     出社時間   帰社時間   備考   ← 3行目（ヘッダー）
山中                                        ← 4行目〜（データ行）
木下
辻野
...
```

## 🔧 設定値（スクリプトプロパティ）

| プロパティ名 | 説明 | デフォルト値 |
|------------|------|-------------|
| `SPREADSHEET_ID` | 対象スプレッドシートID | （必須） |
| `SHEET_NAME` | シート名 | 外出ホワイトボード |
| `DATE_CELL` | 日付セル | D2 |
| `HEADER_RANGE` | ヘッダー範囲 | A3:E3 |
| `DATA_RANGE` | データ範囲 | A4:E19 |

## ✨ 機能

- 📅 日付選択による対象日切り替え
- 📝 行単位での編集・保存
- 🔒 排他制御（DocumentLock）
- ✅ 入力バリデーション（時刻形式チェック）
- 🎨 ステータス表示
  - **オレンジ**: 外出中（出社時間あり・帰社時間なし）
  - **グリーン**: 帰社済み

## ⚠️ 注意事項

- **日付競合**: 複数ユーザーが同時に異なる日付を選択すると、D2セルが上書きされる可能性があります
- **運用推奨**: 基本的に「今日の外出板」として使用
- **将来対応案**: 日付ごとに別シートを作成する方式への移行

## 🔍 トラブルシューティング

### 「SPREADSHEET_ID が設定されていません」

→ `Setup.gs` の `initializeProperties()` を実行してください

### 「シートが見つかりません」

→ `SHEET_NAME` がスプレッドシートのシート名と一致しているか確認

### 「他のユーザーが更新中です」

→ 数秒待ってから再試行してください（ロック競合）

### 権限エラー

→ デプロイ設定で「次のユーザーとして実行：自分」になっているか確認

## 📝 ライセンス

MIT License
